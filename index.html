```html
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chatbot Lyro - Fundaci√≥n Capac√≠tamente</title>

  <style>
    body { margin:0; padding:0; }

    /* Bot√≥n Abrir */
    #chat-toggle{
      position:fixed; bottom:20px; right:20px; padding:15px 20px;
      background:#1E90FF; color:#fff; border:none; border-radius:30px;
      cursor:pointer; z-index:10001; box-shadow:0 4px 12px rgba(0,0,0,.25);
      font-weight:bold; transition: transform .1s, filter .2s;
    }
    #chat-toggle:hover{ filter:brightness(.97); transform: translateY(-2px); }

    /* WhatsApp flotante */
    #whatsapp-toggle{
      position:fixed; bottom:20px; right:200px;
      width:56px; height:56px;
      background:#25D366; border-radius:50%;
      cursor:pointer; z-index:10001;
      box-shadow:0 4px 12px rgba(0,0,0,.25);
      text-decoration:none;
      display:inline-flex; align-items:center; justify-content:center;
      transition: transform .1s, filter .2s;
    }
    #whatsapp-toggle:hover{ filter:brightness(.97); transform: translateY(-2px); }

    .wa-icon{
      width:28px; height:28px;
      background-repeat:no-repeat;
      background-position:center;
      background-size:contain;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cpath fill='%23fff' d='M19.11 17.53c-.27-.13-1.6-.79-1.85-.88-.25-.09-.43-.13-.61.13-.18.27-.7.88-.86 1.06-.16.18-.32.2-.59.07-.27-.13-1.14-.42-2.17-1.34-.8-.71-1.34-1.59-1.5-1.86-.16-.27-.02-.41.12-.55.12-.12.27-.32.41-.48.14-.16.18-.27.27-.45.09-.18.04-.34-.02-.48-.07-.13-.61-1.47-.84-2.01-.22-.53-.45-.46-.61-.47h-.52c-.18 0-.48.07-.73.34-.25.27-.95.93-.95 2.28 0 1.35.98 2.65 1.11 2.83.13.18 1.93 2.95 4.68 4.13.65.28 1.16.45 1.56.57.65.21 1.24.18 1.71.11.52-.08 1.6-.65 1.82-1.28.23-.63.23-1.17.16-1.28-.07-.11-.25-.18-.52-.32z'/%3E%3Cpath fill='%23fff' d='M26.66 5.34A14.9 14.9 0 0016.04.99C7.86.99 1.2 7.64 1.2 15.82c0 2.62.69 5.18 2 7.44L1.08 31l7.9-2.07a14.8 14.8 0 007.06 1.8h.01c8.18 0 14.84-6.65 14.84-14.83 0-3.96-1.55-7.69-4.23-10.56zM16.04 28.2h-.01a12.3 12.3 0 01-6.28-1.72l-.45-.27-4.69 1.23 1.25-4.57-.29-.47a12.3 12.3 0 01-1.89-6.58c0-6.79 5.52-12.31 12.32-12.31a12.24 12.24 0 018.72 3.62 12.25 12.25 0 013.6 8.69c0 6.79-5.52 12.31-12.28 12.38z'/%3E%3C/svg%3E");
    }

    /* Contenedor principal */
    #chat-container{
      position:fixed; bottom:80px; right:20px;
      width:360px; height:640px;
      max-width:92vw; max-height:88vh;
      background:#fff; border-radius:12px;
      box-shadow:0 8px 30px rgba(0,0,0,.3);
      z-index:10000; display:none; flex-direction:column; overflow:hidden;
      font-family:Arial, sans-serif;
    }

    /* Header */
    #chat-header{
      background:#1E90FF; color:#fff; padding:10px 12px;
      font-weight:bold; font-size:1.02em;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    #chat-header .left, #chat-header .right{
      display:flex; align-items:center; gap:8px;
    }

    .header-btn{
      border:none; cursor:pointer;
      border-radius:10px;
      padding:8px 10px;
      background:rgba(255,255,255,.18);
      color:#fff; font-weight:700;
    }
    .header-btn:hover{ filter:brightness(.98); }

    #chat-title{
      font-weight:800;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width:210px;
    }

    /* Drawer historial */
    #history-drawer{
      position:absolute;
      top:0; left:0; bottom:0;
      width:78%;
      background:#0f172a; color:#e5e7eb;
      z-index:10002;
      transform: translateX(-105%);
      transition: transform .18s ease;
      display:flex;
      flex-direction:column;
      border-right:1px solid rgba(255,255,255,.08);
    }
    #history-drawer.open{ transform: translateX(0); }

    #history-top{
      padding:12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.08);
      gap:10px;
    }
    #history-top b{ font-size:1.02em; }

    #history-list{
      overflow:auto;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .day-sep{
      margin:10px 0 2px;
      font-size:.82em;
      opacity:.8;
    }

    .session-item {
      position: relative;
      text-align:left;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:#e5e7eb;
      border-radius:12px;
      padding:10px;
      cursor:pointer;
      display: block;
    }
    .session-item:hover { background:rgba(255,255,255,.10); }
    .session-item.active {
      border-color:rgba(59,130,246,.9);
      box-shadow:0 0 0 1px rgba(59,130,246,.45) inset;
    }

    .session-content-click { width: 85%; }

    .session-item .meta{
      font-size:.78em; opacity:.85;
      display:flex; gap:8px; align-items:center;
      margin-bottom:6px;
      flex-wrap:wrap;
    }
    .pin-badge{
      font-size:.78em;
      background:rgba(255,255,255,.14);
      padding:2px 6px;
      border-radius:999px;
    }

    .session-item .preview{
      font-size:.9em;
      line-height:1.25;
      opacity:.95;
      word-break:break-word;
    }

    .history-more {
      position: absolute;
      top: 8px;
      right: 6px;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      border: none;
      background: transparent;
      color: #94a3b8;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .history-more:hover {
      background: rgba(255,255,255,0.15);
      color: #fff;
    }

    .history-menu {
      display: none;
      position: absolute;
      top: 38px;
      right: 8px;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 4px;
      min-width: 160px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.6);
      z-index: 50;
    }
    .history-menu button {
      width: 100%;
      text-align: left;
      background: transparent;
      border: none;
      color: #cbd5e1;
      padding: 8px 10px;
      font-size: 13px;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .history-menu button:hover {
      background: #334155;
      color: #fff;
    }
    .history-menu .danger { color: #f87171; }
    .history-menu .danger:hover { background: rgba(248, 113, 113, 0.15); }

    /* Mensajes */
    #chat-messages{
      flex:1 1 auto;
      padding:10px;
      overflow-y:auto;
      background:#F4F7F9;
      display:flex;
      flex-direction:column;
    }

    .message{
      padding:8px 12px; margin-bottom:10px; border-radius:18px;
      max-width:80%; line-height:1.35; word-wrap:break-word;
      white-space:pre-wrap;
      position:relative;
    }
    .user{ background:#DCF8C6; align-self:flex-end; margin-left:auto; }
    .bot{ background:#fff; align-self:flex-start; margin-right:auto; border:1px solid #E0E0E0; }

    .time{
      display:block;
      font-size:.72em;
      opacity:.65;
      margin-top:4px;
    }

    /* Footer */
    #chat-footer{
      background:#fff;
      border-top:1px solid #eee;
      flex: 0 0 auto;
      display:flex;
      flex-direction:column;
    }

    /* Sugerencias */
    #suggestion-buttons{
      padding:10px;
      background:#F4F7F9;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      border-bottom:1px solid #eee;

      max-height: 160px;
      overflow-y: auto;
      overscroll-behavior: contain;
      scrollbar-width: thin;
    }
    #suggestion-buttons::-webkit-scrollbar{ width: 10px; }
    #suggestion-buttons::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.18); border-radius: 999px; }
    #suggestion-buttons::-webkit-scrollbar-track{ background: transparent; }

    /* ‚úÖ Botones con ‚Äúruedita‚Äù para opciones num√©ricas */
    .suggestion{
      background:#fff; color:#1E90FF; border:1px solid #1E90FF;
      padding:8px 12px; border-radius:20px; cursor:pointer; font-size:.85em;
      transition: background-color .2s, color .2s;
      flex: 0 0 auto;

      display:flex;
      align-items:center;
      gap:8px;
    }
    .suggestion:hover{ background:#1E90FF; color:#fff; }

    .suggestion-badge{
      width:20px; height:20px;
      border-radius:999px;
      background:#1E90FF;
      color:#fff;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size:.78em;
      font-weight:800;
      flex: 0 0 20px;
      line-height: 1;
    }
    .suggestion:hover .suggestion-badge{
      background:#fff;
      color:#1E90FF;
    }

    .suggestion-text{
      display:inline-block;
      line-height:1.1;
      font-weight:700;
      white-space: nowrap;
    }

    /* Input */
    #chat-input-area{
      display:flex; padding:10px;
      background:#fff;
    }
    #chat-input{
      flex-grow:1; padding:10px;
      border:1px solid #E0E0E0; border-radius:20px;
      margin-right:8px; font-size:1em; outline:none;
    }
    #send-button{
      background:#1E90FF; color:#fff; border:none; border-radius:20px;
      padding:10px 15px; font-weight:bold; cursor:pointer;
    }
    #send-button:disabled{ opacity:.7; cursor:not-allowed; }
  </style>
</head>

<body>
  <button id="chat-toggle">ü§ñ Chatea con Lyro</button>

  <a id="whatsapp-toggle" href="https://wa.me/593991667561" target="_blank" rel="noopener noreferrer" aria-label="WhatsApp">
    <span class="wa-icon" aria-hidden="true"></span>
  </a>

  <div id="chat-container">
    <!-- Drawer historial -->
    <div id="history-drawer">
      <div id="history-top">
        <b>üìö Historial</b>
        <button class="header-btn" id="history-close">‚úï</button>
      </div>
      <div id="history-list"></div>
    </div>

    <div id="chat-header">
      <div class="left">
        <button class="header-btn" id="history-open">‚ò∞</button>
        <div id="chat-title">Lyro-Capac√≠tamente</div>
      </div>
      <div class="right">
        <button class="header-btn" id="new-chat">Ôºã Nueva</button>
      </div>
    </div>

    <div id="chat-messages"></div>

    <div id="chat-footer">
      <div id="suggestion-buttons"></div>

      <div id="chat-input-area">
        <input type="text" id="chat-input" placeholder="Escribe tu pregunta...">
        <button id="send-button">Enviar</button>
      </div>
    </div>
  </div>

  <script>
    // ‚ö†Ô∏è Cambia esto si tu URL es distinta
    const SERVER_URL = "https://lyro-chatbot-capacitamente.onrender.com";

    // ====== ClientId persistente ======
    const CLIENT_ID_KEY = "lyroClientId";
    let clientId = localStorage.getItem(CLIENT_ID_KEY);
    if (!clientId) {
      clientId = (crypto.randomUUID ? crypto.randomUUID() : ("cid-" + Date.now() + "-" + Math.random().toString(36).slice(2)));
      localStorage.setItem(CLIENT_ID_KEY, clientId);
    }

    // ====== SessionId persistente ======
    const SESSION_KEY = "chatSessionId";
    let currentSessionId = localStorage.getItem(SESSION_KEY) || "";

    // ====== Elementos UI ======
    const toggleButton = document.getElementById("chat-toggle");
    const chatContainer = document.getElementById("chat-container");
    const sendButton = document.getElementById("send-button");
    const chatInput = document.getElementById("chat-input");
    const chatMessages = document.getElementById("chat-messages");
    const suggestionWrap = document.getElementById("suggestion-buttons");

    const historyDrawer = document.getElementById("history-drawer");
    const historyOpen = document.getElementById("history-open");
    const historyClose = document.getElementById("history-close");
    const historyList = document.getElementById("history-list");
    const newChatBtn = document.getElementById("new-chat");

    // ====== Sugerencias default ======
    const DEFAULT_MENU_SUGGESTIONS = [
      { text: "1", label: "1) Cursos gratis" },
      { text: "2", label: "2) Cursos con certificados y precios" },
      { text: "3", label: "3) Contacto" },
      { text: "4", label: "4) Donar" },
      { text: "5", label: "5) Estado de certificado" },
      { text: "6", label: "6) Horarios" },
    ];

    // ====== Utils ======
    function fmtDate(d) {
      return new Date(d).toLocaleDateString("es-EC", { year:"numeric", month:"2-digit", day:"2-digit" });
    }
    function fmtTime(d) {
      return new Date(d).toLocaleTimeString("es-EC", { hour:"2-digit", minute:"2-digit" });
    }

    function clearMessages() { chatMessages.innerHTML = ""; }

    function addMessage(text, sender, createdAt = null) {
      const msg = document.createElement("div");
      msg.className = "message " + sender;

      const content = document.createElement("div");
      content.textContent = text;

      const time = document.createElement("span");
      time.className = "time";
      time.textContent = createdAt ? (fmtDate(createdAt) + " " + fmtTime(createdAt)) : (fmtTime(Date.now()));

      msg.appendChild(content);
      msg.appendChild(time);

      chatMessages.appendChild(msg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function roleToSender(role) {
      const r = String(role || "").toLowerCase();
      if (r.includes("user") || r.includes("usuario")) return "user";
      return "bot";
    }

    function setBusy(isBusy) {
      sendButton.disabled = isBusy;
      chatInput.disabled = isBusy;
    }

    function safeText(s) {
      return String(s || "").replace(/\r/g, "").trim();
    }

    // ====== Render sugerencias (con ruedita si es "N) ...") ======
    function splitNumericLabel(label) {
      const m = String(label || "").trim().match(/^(\d+)\)\s*(.+)$/);
      if (!m) return null;
      return { num: m[1], text: m[2] };
    }

    function renderSuggestions(list) {
      const items = Array.isArray(list) && list.length ? list : DEFAULT_MENU_SUGGESTIONS;
      suggestionWrap.innerHTML = "";

      items.forEach(it => {
        const btn = document.createElement("button");
        btn.className = "suggestion";
        btn.type = "button";

        const sendText = String(it.text || "").trim() || String(it.label || "").trim();
        btn.dataset.text = sendText;

        const labelRaw = String(it.label || it.text || "").trim();
        const parts = splitNumericLabel(labelRaw);

        if (parts) {
          const badge = document.createElement("span");
          badge.className = "suggestion-badge";
          badge.textContent = parts.num;

          const txt = document.createElement("span");
          txt.className = "suggestion-text";
          txt.textContent = parts.text;

          btn.appendChild(badge);
          btn.appendChild(txt);
        } else {
          // Para botones no num√©ricos, solo texto
          const txt = document.createElement("span");
          txt.className = "suggestion-text";
          txt.textContent = labelRaw || sendText;
          btn.appendChild(txt);
        }

        btn.addEventListener("click", () => {
          const t = btn.dataset.text || "";
          if (!t) return;
          chatInput.value = t;
          sendMessage();
        });

        suggestionWrap.appendChild(btn);
      });
    }

    // ====== Fetch helper ======
    async function api(path, options = {}) {
      const headers = Object.assign(
        { "Content-Type": "application/json", "x-client-id": clientId },
        options.headers || {}
      );
      const res = await fetch(SERVER_URL + path, Object.assign({}, options, { headers }));
      const text = await res.text();
      let data = null;
      try { data = JSON.parse(text); } catch { data = { raw: text }; }
      return { ok: res.ok, status: res.status, data };
    }

    // ====== Chat: enviar mensaje ======
    async function sendMessage() {
      const message = safeText(chatInput.value);
      if (!message) return;

      chatInput.value = "";
      addMessage(message, "user", Date.now());
      setBusy(true);

      try {
        const body = { message, sessionId: currentSessionId };
        const r = await api("/chat", { method: "POST", body: JSON.stringify(body) });

        if (!r.ok) {
          addMessage("No pude enviar el mensaje. Intenta nuevamente.", "bot", Date.now());
          renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
          return;
        }

        const reply = safeText(r.data.reply);
        const sid = String(r.data.sessionId || currentSessionId || "").trim();

        if (sid && sid !== currentSessionId) {
          currentSessionId = sid;
          localStorage.setItem(SESSION_KEY, currentSessionId);
        }

        if (reply) addMessage(reply, "bot", Date.now());

        if (Array.isArray(r.data.suggestions)) renderSuggestions(r.data.suggestions);
        else renderSuggestions(DEFAULT_MENU_SUGGESTIONS);

      } catch (e) {
        addMessage("Error de conexi√≥n. Revisa tu internet o el servidor.", "bot", Date.now());
        renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
      } finally {
        setBusy(false);
      }
    }

    // ====== Historial: cargar mensajes ======
    async function loadHistory(sessionId) {
      if (!sessionId) return;

      setBusy(true);
      try {
        const r = await api("/history/" + encodeURIComponent(sessionId) + "?limit=300", { method: "GET" });

        clearMessages();

        if (!r.ok) {
          addMessage("No pude cargar el historial.", "bot", Date.now());
          renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
          return;
        }

        const msgs = Array.isArray(r.data.messages) ? r.data.messages : [];
        msgs.forEach(m => {
          addMessage(safeText(m.content), roleToSender(m.role), m.created_at || Date.now());
        });

        renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
      } catch (e) {
        clearMessages();
        addMessage("Error al cargar historial.", "bot", Date.now());
        renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
      } finally {
        setBusy(false);
      }
    }

    // ====== Sesiones: crear nueva ======
    async function createNewSessionAndLoad() {
      setBusy(true);
      try {
        const r = await api("/sessions", { method: "POST", body: JSON.stringify({}) });
        if (!r.ok) {
          addMessage("No pude crear una nueva conversaci√≥n.", "bot", Date.now());
          return;
        }

        const sid = String(r.data.sessionId || "").trim();
        if (!sid) {
          addMessage("No se recibi√≥ sessionId.", "bot", Date.now());
          return;
        }

        currentSessionId = sid;
        localStorage.setItem(SESSION_KEY, currentSessionId);

        await loadHistory(currentSessionId);
        await loadSessionsList(); // refresca drawer
      } catch (e) {
        addMessage("Error creando conversaci√≥n.", "bot", Date.now());
      } finally {
        setBusy(false);
      }
    }

    // ====== Drawer: cargar lista de sesiones ======
    function closeAllHistoryMenus() {
      const menus = historyList.querySelectorAll(".history-menu");
      menus.forEach(m => m.style.display = "none");
    }

    async function loadSessionsList() {
      try {
        const r = await api("/sessions?limit=60", { method: "GET" });
        historyList.innerHTML = "";

        if (!r.ok) {
          const div = document.createElement("div");
          div.className = "session-item";
          div.textContent = "No pude cargar sesiones.";
          historyList.appendChild(div);
          return;
        }

        const sessions = Array.isArray(r.data.sessions) ? r.data.sessions : [];
        if (!sessions.length) {
          const div = document.createElement("div");
          div.className = "session-item";
          div.textContent = "A√∫n no hay conversaciones.";
          historyList.appendChild(div);
          return;
        }

        // agrupar por d√≠a usando last_message_at o created_at
        let lastDay = "";
        sessions.forEach(s => {
          const when = s.last_message_at || s.created_at || s.last_seen || Date.now();
          const day = fmtDate(when);
          if (day !== lastDay) {
            const sep = document.createElement("div");
            sep.className = "day-sep";
            sep.textContent = day;
            historyList.appendChild(sep);
            lastDay = day;
          }

          const item = document.createElement("div");
          item.className = "session-item";
          if (String(s.session_id) === String(currentSessionId)) item.classList.add("active");

          const contentClick = document.createElement("div");
          contentClick.className = "session-content-click";

          const meta = document.createElement("div");
          meta.className = "meta";

          const title = document.createElement("span");
          const conv = s.conversation_number ? ("Conv. #" + s.conversation_number) : ("Conv. " + String(s.session_id || "").slice(-6));
          title.textContent = conv;

          const time = document.createElement("span");
          time.textContent = fmtTime(when);

          meta.appendChild(title);
          meta.appendChild(time);

          if (s.pinned) {
            const pin = document.createElement("span");
            pin.className = "pin-badge";
            pin.textContent = "üìå";
            meta.appendChild(pin);
          }

          const preview = document.createElement("div");
          preview.className = "preview";
          preview.textContent = safeText(s.last_message_preview || "Sin mensajes a√∫n.");

          contentClick.appendChild(meta);
          contentClick.appendChild(preview);

          contentClick.addEventListener("click", async () => {
            currentSessionId = String(s.session_id || "");
            localStorage.setItem(SESSION_KEY, currentSessionId);
            closeAllHistoryMenus();
            await loadHistory(currentSessionId);
            await loadSessionsList();
            historyDrawer.classList.remove("open");
          });

          // men√∫ 3 puntos
          const moreBtn = document.createElement("button");
          moreBtn.className = "history-more";
          moreBtn.type = "button";
          moreBtn.textContent = "‚ãØ";

          const menu = document.createElement("div");
          menu.className = "history-menu";

          const pinBtn = document.createElement("button");
          pinBtn.type = "button";
          pinBtn.textContent = s.pinned ? "üìå Quitar pin" : "üìå Fijar";

          pinBtn.addEventListener("click", async (ev) => {
            ev.stopPropagation();
            closeAllHistoryMenus();
            const pinned = !s.pinned;
            await api("/session/" + encodeURIComponent(s.session_id) + "/pin", {
              method: "POST",
              body: JSON.stringify({ pinned })
            });
            await loadSessionsList();
          });

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.className = "danger";
          delBtn.textContent = "üóëÔ∏è Eliminar";

          delBtn.addEventListener("click", async (ev) => {
            ev.stopPropagation();
            closeAllHistoryMenus();

            const ok = confirm("¬øEliminar esta conversaci√≥n? Se borrar√° el historial.");
            if (!ok) return;

            await api("/session/" + encodeURIComponent(s.session_id), { method: "DELETE" });

            // Si borraste la actual, crea otra
            if (String(s.session_id) === String(currentSessionId)) {
              currentSessionId = "";
              localStorage.removeItem(SESSION_KEY);
              clearMessages();
              renderSuggestions(DEFAULT_MENU_SUGGESTIONS);
              await createNewSessionAndLoad();
              return;
            }

            await loadSessionsList();
          });

          menu.appendChild(pinBtn);
          menu.appendChild(delBtn);

          moreBtn.addEventListener("click", (ev) => {
            ev.stopPropagation();
            const visible = menu.style.display === "block";
            closeAllHistoryMenus();
            menu.style.display = visible ? "none" : "block";
          });

          item.appendChild(contentClick);
          item.appendChild(moreBtn);
          item.appendChild(menu);

          historyList.appendChild(item);
        });

      } catch (e) {
        historyList.innerHTML = "";
        const div = document.createElement("div");
        div.className = "session-item";
        div.textContent = "Error cargando sesiones.";
        historyList.appendChild(div);
      }
    }

    // cerrar men√∫s al hacer click fuera
    document.addEventListener("click", (e) => {
      if (!historyDrawer.classList.contains("open")) return;
      const isMenu = e.target.closest(".history-menu") || e.target.closest(".history-more");
      if (!isMenu) closeAllHistoryMenus();
    });

    // ====== Eventos UI ======
    toggleButton.addEventListener("click", async () => {
      const isOpen = chatContainer.style.display === "flex";
      chatContainer.style.display = isOpen ? "none" : "flex";

      if (!isOpen) {
        // Al abrir: asegura sesi√≥n
        if (!currentSessionId) {
          await createNewSessionAndLoad();
        } else {
          await loadHistory(currentSessionId);
        }
      }
    });

    historyOpen.addEventListener("click", async () => {
      historyDrawer.classList.add("open");
      await loadSessionsList();
    });

    historyClose.addEventListener("click", () => {
      historyDrawer.classList.remove("open");
      closeAllHistoryMenus();
    });

    newChatBtn.addEventListener("click", async () => {
      closeAllHistoryMenus();
      historyDrawer.classList.remove("open");
      await createNewSessionAndLoad();
    });

    sendButton.addEventListener("click", sendMessage);

    chatInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") sendMessage();
    });

    // ====== Inicial ======
    renderSuggestions(DEFAULT_MENU_SUGGESTIONS);

    // Si ya hay sesi√≥n guardada, puedes precargar historial (opcional)
    // Si no quieres precargar, comenta esto.
    (async () => {
      if (currentSessionId) {
        // no abre el chat, solo prepara data por si abres
        // si prefieres cargar al abrir, comenta lo de abajo
        try { await loadHistory(currentSessionId); } catch {}
      }
    })();
  </script>
</body>
</html>
```
